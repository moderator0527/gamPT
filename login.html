<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wiserlab 로그인</title>

  <!-- Pretendard -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --brand:#10a37f; --bg:#ffffff; --text:#111827; --muted:#6b7280; --line:#e5e7eb;
      --radius:14px; --shadow:0 6px 18px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;height:100%;background:var(--bg);color:var(--text);
      font-family:"Pretendard",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo",Arial,sans-serif;
      display:flex;align-items:center;justify-content:center
    }
    .card{
      width:360px;background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);
      padding:40px 30px;text-align:center
    }
    .orb{width:14px;height:14px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#8ff3da,var(--brand));
      box-shadow:0 0 14px rgba(16,163,127,.65);margin-right:8px;display:inline-block;vertical-align:middle}
    h1{font-size:20px;font-weight:800;margin:0 0 20px 0;display:flex;align-items:center;justify-content:center;gap:8px}
    p{font-size:14px;color:var(--muted);margin-bottom:28px}
    .auth-btn{
      width:100%; border:1px solid var(--line); border-radius:999px; padding:12px 16px;
      font-size:15px; font-weight:700; cursor:pointer; background:#fff; display:flex; align-items:center; justify-content:center; gap:10px;
      box-shadow:var(--shadow);
    }
    .auth-btn:hover{background:#f9fafb}
    .auth-btn img{width:18px;height:18px}
    .hint{margin-top:24px;font-size:12px;color:var(--muted)}
    .error{margin-top:16px; font-size:12px; color:#b91c1c}
    footer{position:fixed;bottom:20px;width:100%;text-align:center;color:#94a3b8;font-size:12px}
  </style>
</head>
<body>
  <div class="card">
    <h1><span class="orb"></span>와이저랩 회원 로그인</h1>
    <p>Google 계정으로 로그인하여 <br>와이저랩의 모든 서비스를 이용하세요.</p>

    <!-- Supabase 구글 로그인 버튼 -->
    <button class="auth-btn" id="google-login-btn" type="button">
      <img alt="" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg">
      <span>Google로 로그인</span>
    </button>

    <div class="hint">로그인 후 자동으로 메인 페이지로 이동합니다.</div>
    <div class="error" id="err" style="display:none;"></div>
  </div>

  <footer>© 2025 Team Wiserlab</footer>

  <script>
    // 1) Supabase 초기화 (Anon Key만! 절대 service_role 키를 노출하지 마세요)
    const SUPABASE_URL = "https://vzvkexbqkqstcktbbgjt.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ6dmtleGJxa3FzdGNrdGJiZ2p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwOTA1MjQsImV4cCI6MjA3NzY2NjUyNH0.fM7ktZjsE08eaM99UsLMYYqutHpeAyMvj5U2StF6aD0";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 2) 버튼 클릭 시 구글 OAuth 시작 → 콜백 후 index2.html로 리다이렉트
    const loginBtn = document.getElementById('google-login-btn');
    const errBox = document.getElementById('err');

    loginBtn.addEventListener('click', async () => {
      try {
        const { error } = await supabase.auth.signInWithOAuth({
          provider: 'google',
          options: {
            // 로그인 완료 후 돌아갈 URL
            redirectTo: 'https://gampt.xyz/index2.html'
          }
        });
        if (error) throw error;
        // 실제로는 위 호출이 외부 구글 로그인 페이지로 이동합니다.
      } catch (e) {
        errBox.style.display = 'block';
        errBox.textContent = '로그인 중 오류가 발생했습니다: ' + (e?.message || e);
        console.error(e);
      }
    });

    // 3) 이미 로그인 상태로 들어온 경우엔 바로 index2.html로
    (async () => {
      const { data: { session } } = await supabase.auth.getSession();
      if (session) {
        // 여기서의 user 메타데이터는 UTF-8로 안전합니다 (한글 이름 깨짐 방지)
        // 예: const name = session.user.user_metadata.full_name || session.user.user_metadata.name;
        window.location.replace('https://gampt.xyz/index2.html');
      }
    })();
  </script>
</body>
</html>

